<?xml version="1.0" encoding="UTF-8" ?>

<SmartSqlMap Scope="org.activiti.engine.impl.persistence.entity.IdentityInfoEntityImpl"  xmlns="http://SmartSql.net/schemas/SmartSqlMap.xsd">

  <!-- INFO RESULTMAP -->

  <ResultMap Id="identityInfoResultMap" ResultType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntityImpl,Sys.Bpm.Engine">
    <Result Property="id" Column="ID_" />
    <Result Property="revision" Column="REV_" />
    <Result Property="userId" Column="USER_ID_" />
    <Result Property="type" Column="TYPE_" />
    <Result Property="key" Column="KEY_" />
    <Result Property="value" Column="VALUE_" />
    <Result Property="passwordBytes" Column="PASSWORD_" />
    <Result Property="parentId" Column="PARENT_ID_" />
  </ResultMap>

  <!-- INFO INSERT -->

  <Insert Id="insertIdentityInfo">
    insert into ACT_ID_INFO (ID_, REV_, USER_ID_, TYPE_, KEY_, VALUE_, PASSWORD_, PARENT_ID_)
    values (
    @id,
    1,
    @userId,
    @type,
    @key,
    @value,
    @passwordBytes,
    @parentId
    )
  </Insert>

  <Insert Id="bulkInsertIdentityInfo">
    insert into ACT_ID_INFO (ID_, REV_, USER_ID_, TYPE_, KEY_, VALUE_, PASSWORD_, PARENT_ID_)
    values
    <For Property="list" Key="identityInfo" Separator=",">
      (@id,
      1,
      @userId,
      @type,
      @key,
      @value,
      @passwordBytes,
      @parentId)
    </For>
  </Insert>

  <!-- INFO UPDATE -->
  <Update Id="updateIdentityInfo">
    update ACT_ID_INFO
    set REV_ = @revisionNext,
    VALUE_ = @value,
    PASSWORD_ = @passwordBytes
    where ID_ = @id
    and REV_ = @revision
  </Update>

  <!-- INFO DELETE -->

  <Delete Id="deleteIdentityInfo">
    delete from ACT_ID_INFO
    where ID_ = @id and REV_ = @revision
  </Delete>

  <!-- INFO SELECT -->

  <Select Id="selectIdentityInfoById" ResultMap="identityInfoResultMap">
    select * from ACT_ID_INFO where ID_ = @id
  </Select>

  <Select Id="selectIdentityInfoByUserIdAndKey" ResultMap="identityInfoResultMap">
    select * from ACT_ID_INFO
    where USER_ID_ = @userId
    and KEY_ =  @key
    and PARENT_ID_ is null
  </Select>

  <Select Id="selectIdentityInfoKeysByUserIdAndType">
    select KEY_ from ACT_ID_INFO
    where USER_ID_ = @userId
    and TYPE_ =  @type
    and PARENT_ID_ is null
  </Select>

  <Select Id="selectIdentityInfoByUserId" ResultMap="identityInfoResultMap">
    select * from ACT_ID_INFO where USER_ID_ = @parameter
  </Select>

  <Select Id="selectIdentityInfoDetails" ResultMap="identityInfoResultMap">
    select * from ACT_ID_INFO where PARENT_ID_ = @parameter
  </Select>

</SmartSqlMap>